<idea-plugin>
    <id>com.block.agenttaskqueue</id>
    <name>Agent Task Queue</name>
    <vendor url="https://github.com/block/agent-task-queue" email="oss@block.xyz">Block</vendor>
    <description><![CDATA[
        <p>Real-time visibility into the <b>agent-task-queue</b> build serializer â€”
        a task queue that prevents concurrent builds from freezing your machine.</p>
        <ul>
            <li>Status bar widget showing running task and queue depth</li>
            <li>Tool window with live queue table and per-task streaming output</li>
            <li>Balloon notifications for task start, finish, and failure</li>
            <li>One-click task cancellation and queue management</li>
        </ul>
        <p>Requires the <a href="https://github.com/block/agent-task-queue">agent-task-queue</a>
        MCP server (v0.3.x+) to be running.</p>
    ]]></description>
    <change-notes><![CDATA[
        <b>0.3.2</b>
        <ul>
            <li>Initial release</li>
            <li>Status bar widget with configurable display modes</li>
            <li>Tool window with queue table and per-task output tabs</li>
            <li>Balloon notifications for task lifecycle events</li>
            <li>Task cancellation via process group termination</li>
            <li>Stale task detection and cleanup</li>
        </ul>
    ]]></change-notes>

    <depends>com.intellij.modules.platform</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Services -->
        <applicationService serviceImplementation="com.block.agenttaskqueue.model.TaskQueueModel"/>
        <applicationService serviceImplementation="com.block.agenttaskqueue.settings.TaskQueueSettings"/>
        <applicationService serviceImplementation="com.block.agenttaskqueue.data.TaskQueueDatabase"/>
        <applicationService serviceImplementation="com.block.agenttaskqueue.data.TaskQueuePoller"/>
        <applicationService serviceImplementation="com.block.agenttaskqueue.data.TaskCanceller"/>
        <applicationService serviceImplementation="com.block.agenttaskqueue.data.TaskQueueNotifier"/>

        <!-- Notifications -->
        <notificationGroup id="Agent Task Queue" displayType="BALLOON"/>

        <!-- Tool Window -->
        <toolWindow id="Agent Task Queue"
                    factoryClass="com.block.agenttaskqueue.ui.TaskQueueToolWindowFactory"
                    anchor="bottom"
                    secondary="true"
                    canCloseContents="true"
                    icon="/icons/taskQueue.svg"/>

        <!-- Status Bar Widget -->
        <statusBarWidgetFactory id="AgentTaskQueueStatusBar"
                                implementation="com.block.agenttaskqueue.ui.TaskQueueStatusBarWidgetFactory"
                                order="after encodingWidget"/>

        <!-- Settings -->
        <applicationConfigurable id="com.block.agenttaskqueue.settings"
                                 displayName="Agent Task Queue"
                                 parentId="tools"
                                 instance="com.block.agenttaskqueue.settings.TaskQueueConfigurable"/>
    </extensions>

    <actions>
        <group id="AgentTaskQueueToolbar" text="Agent Task Queue Actions">
            <action id="AgentTaskQueue.Refresh"
                    class="com.block.agenttaskqueue.actions.RefreshQueueAction"
                    text="Refresh"
                    description="Refresh the task queue"
                    icon="AllIcons.Actions.Refresh"/>
            <action id="AgentTaskQueue.Cancel"
                    class="com.block.agenttaskqueue.actions.CancelTaskAction"
                    text="Cancel Task"
                    description="Cancel the selected task"
                    icon="AllIcons.Actions.Cancel"/>
            <action id="AgentTaskQueue.Clear"
                    class="com.block.agenttaskqueue.actions.ClearQueueAction"
                    text="Clear Queue"
                    description="Clear all tasks from the queue"
                    icon="AllIcons.Actions.GC"/>
            <action id="AgentTaskQueue.ViewOutput"
                    class="com.block.agenttaskqueue.actions.OpenOutputLogAction"
                    text="View Output"
                    description="Open the output log for the selected task"
                    icon="AllIcons.Actions.Preview"/>
            <separator/>
            <action id="AgentTaskQueue.Settings"
                    class="com.block.agenttaskqueue.actions.OpenSettingsAction"
                    text="Settings"
                    description="Open Agent Task Queue settings"
                    icon="AllIcons.General.GearPlain"/>
        </group>
    </actions>
</idea-plugin>
